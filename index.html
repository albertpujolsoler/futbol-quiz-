
<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Fútbol Quiz — Online</title>
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='0.9em' font-size='90'%3E%F0%9F%8F%8A%EF%B8%8F%3C/text%3E%3C/svg%3E">
<style>
  :root{--bg:#0b0b0e;--card:#ffffffee;--accent:#1f8eeb;--ok:#22c55e;--wrong:#fecaca;--text:#0d0d10;}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font:16px system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,'Helvetica Neue',Arial}
  .wrap{min-height:100svh;display:grid;place-items:center;padding:16px}
  .card{width:min(680px,100%);background:var(--card);border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.35);padding:16px}
  h1,h2{margin:0 0 8px}
  .row{display:flex;justify-content:space-between;align-items:center;gap:12px}
  .muted{color:#5f5f6a;font-size:12px}
  .btn{appearance:none;border:0;border-radius:14px;background:var(--accent);color:#fff;font-weight:600;padding:12px 16px;cursor:pointer}
  .btn:disabled{opacity:.55;cursor:not-allowed}
  input,.input{width:100%;padding:12px 14px;border-radius:14px;border:1px solid #ddd;outline:none}
  .question{font-weight:700;text-align:center;border:1px solid #e6e6ea;border-radius:14px;padding:14px}
  .opts{display:grid;gap:10px}
  .opt{background:#fff;border:1px solid #e6e6ea;border-radius:14px;padding:14px;text-align:left;transition:transform .08s ease,opacity .3s}
  .opt:active{transform:scale(.98)}
  .progress{height:8px;background:#00000012;border-radius:999px;overflow:hidden}
  .bar{height:100%;background:var(--accent);width:0%}
  .fade{opacity:0;transition:opacity .3s ease}
  .fade.show{opacity:1}
  .pill{display:inline-flex;align-items:center;gap:8px;background:#f3f4f7;border-radius:999px;padding:6px 10px;font-size:12px}
  .list{display:grid;gap:8px}
  .rowitem{display:flex;align-items:center;justify-content:space-between;border:1px solid #e8e8ee;border-radius:12px;padding:10px;background:#fff}
  .small{font-size:13px}
  .center{text-align:center}
  @media (max-width:420px){ body{font-size:15px} }
</style>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
</head>
<body>
<div class="wrap"><div class="card">
  <div id="app" class="fade show"></div>
</div></div>
<script>
(function(){
  // ====== Supabase ======
  const SUPABASE_URL = 'https://lhxnrmijoojreqmuvogm.supabase.co';
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxoeG5ybWlqb29qcmVxbXV2b2dtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU5NzA0NzIsImV4cCI6MjA3MTU0NjQ3Mn0.mqTS1JHa9XlcG2EcfOVyhBZYltoyGk1kT4xHaYEi_20';
  var hasSB = Boolean(SUPABASE_URL && SUPABASE_ANON_KEY && window.supabase && window.supabase.createClient);
  var sb = null;
  if (hasSB) { try { sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY); } catch(e){ console.error('Supabase init error:', e); hasSB=false; } }

  // ====== Config ======
  var PIN_CODE='1899', QUESTIONS_COUNT=40, SECONDS_PER_QUESTION=10, STREAK_BONUS_AT=10;
  var LS={ leaderboard:'futquiz_leaderboard_v1' };

  // ====== Preguntas (40 en total, se juegan TODAS) ======
  var QUESTIONS=[
    // 20 originales
    { t:'¿En qué año ganó España su primer Mundial?', o:['1998','2002','2010','2014','2018'], c:2 },
    { t:'¿Qué club tiene más Champions League?', o:['AC Milan','Real Madrid','Bayern','Liverpool','Barcelona'], c:1 },
    { t:'¿Quién es el máximo goleador histórico de la selección argentina?', o:['Batistuta','Agüero','Messi','Maradona','Higuaín'], c:2 },
    { t:'¿En qué país se celebró el Mundial 1994?', o:['Italia','Francia','EE. UU.','Alemania','México'], c:2 },
    { t:'¿Qué equipo es conocido como "La Vecchia Signora"?', o:['Inter','Juventus','Roma','Lazio','Torino'], c:1 },
    { t:'¿Quién ganó el Balón de Oro 2023?', o:['Haaland','Mbappé','Messi','Benzema','De Bruyne'], c:2 },
    { t:'¿Cuál es el estadio del Borussia Dortmund?', o:['Allianz Arena','Signal Iduna Park','Veltins-Arena','Red Bull Arena','Olympiastadion'], c:1 },
    { t:'¿Qué selección tiene más Copas del Mundo?', o:['Alemania','Italia','Brasil','Argentina','Francia'], c:2 },
    { t:'¿Qué entrenador popularizó el tiki-taka en el Barcelona 2008–12?', o:['Luis Enrique','Cruyff','Guardiola','Rijkaard','Koeman'], c:2 },
    { t:'¿Quién marcó el "gol del siglo" en 1986?', o:['Maradona','Pelé','Platini','Lineker','Zico'], c:0 },
    { t:'¿Qué selección ganó la Eurocopa 2004?', o:['Portugal','Francia','Grecia','España','Italia'], c:2 },
    { t:'¿Cuál es el apodo del Atlético de Madrid?', o:['Periquitos','Colchoneros','Txuri-urdin','Leones','Che'], c:1 },
    { t:'¿Qué club español juega en Mestalla?', o:['Sevilla','Villarreal','Valencia','Betis','Getafe'], c:2 },
    { t:'¿Quién ganó la Champions 2020 (burbuja)?', o:['PSG','Chelsea','Real Madrid','Bayern','Liverpool'], c:3 },
    { t:'¿Qué selección ganó el Mundial 2014?', o:['Alemania','Argentina','Brasil','España','Países Bajos'], c:0 },
    { t:'¿Cuántos jugadores por equipo hay en el campo?', o:['9','10','11','12','13'], c:2 },
    { t:'¿Qué tarjetas usa el árbitro?', o:['Roja','Amarilla','Verde','Azul','Solo amarilla y roja'], c:4 },
    { t:'¿Máximo goleador histórico de la Champions?', o:['Messi','Cristiano Ronaldo','Lewandowski','Raúl','Benzema'], c:1 },
    { t:'¿Qué club es apodado "Rossoneri"?', o:['Juventus','Inter','Milan','Napoli','Fiorentina'], c:2 },
    { t:'¿Qué selección ganó el Mundial 2022?', o:['Francia','Argentina','Croacia','Brasil','Marruecos'], c:1 },

    // 20 nuevas
    { t:'¿Qué selección ganó el primer Mundial en 1930?', o:['Brasil','Argentina','Uruguay','Italia','Alemania'], c:2 },
    { t:'¿Qué portero fue apodado “La Araña Negra”?', o:['Yashin','Casillas','Neuer','Buffon','Schmeichel'], c:0 },
    { t:'¿Qué jugador es conocido como “El Fenómeno”?', o:['Ronaldo Nazário','Ronaldinho','Cristiano Ronaldo','Rivaldo','Romário'], c:0 },
    { t:'¿Qué club inglés tiene el apodo de “The Reds”?', o:['Chelsea','Liverpool','Arsenal','Manchester United','Everton'], c:1 },
    { t:'¿Quién anotó el famoso gol con “la mano de Dios”?', o:['Pelé','Maradona','Kempes','Caniggia','Messi'], c:1 },
    { t:'¿Qué selección fue campeona de la Eurocopa 2016?', o:['Francia','Alemania','Portugal','España','Italia'], c:2 },
    { t:'¿En qué año debutó Lionel Messi con el Barcelona en partido oficial?', o:['2002','2003','2004','2005','2006'], c:2 },
    { t:'¿Qué jugador es apodado “La Pulga”?', o:['Agüero','Messi','Maradona','Di María','Tevez'], c:1 },
    { t:'¿Qué país fue anfitrión del Mundial 2002 junto con Corea del Sur?', o:['Japón','China','Tailandia','Vietnam','Indonesia'], c:0 },
    { t:'¿Cuál es el club con más títulos de la Serie A italiana?', o:['Inter','Juventus','Milan','Roma','Napoli'], c:1 },
    { t:'¿Qué selección eliminó a España en el Mundial 2002 con el “gol fantasma”?', o:['Corea del Sur','Japón','Alemania','Brasil','Turquía'], c:0 },
    { t:'¿Qué jugador marcó el gol de la final del Mundial 2010?', o:['Villa','Torres','Iniesta','Xavi','Ramos'], c:2 },
    { t:'¿En qué país nació Zlatan Ibrahimović?', o:['Bosnia','Croacia','Suecia','Serbia','Kosovo'], c:2 },
    { t:'¿Qué entrenador fue conocido como “The Special One”?', o:['Guardiola','Mourinho','Ferguson','Wenger','Ancelotti'], c:1 },
    { t:'¿Qué país ganó la Copa América 2021?', o:['Brasil','Argentina','Chile','Uruguay','Colombia'], c:1 },
    { t:'¿Qué club ganó la Champions League en 2005 en la famosa final de Estambul?', o:['Milan','Liverpool','Chelsea','Juventus','Real Madrid'], c:1 },
    { t:'¿Cuál fue la primera selección africana en llegar a semifinales de un Mundial?', o:['Nigeria','Senegal','Ghana','Marruecos','Camerún'], c:3 },
    { t:'¿Qué dorsal llevaba Diego Maradona en el Mundial 1986?', o:['7','9','10','11','8'], c:2 },
    { t:'¿Qué jugador ganó 5 Balones de Oro antes de 2020 además de Messi y Cristiano?', o:['Platini','Cruyff','Van Basten','Ronaldo Nazário','Nadie'], c:4 },
    { t:'¿Qué selección es conocida como “Los Tres Leones”?', o:['Escocia','Inglaterra','Irlanda','Gales','Países Bajos'], c:1 }
  ];

  // ====== Utils ======
  function $(sel){ return document.querySelector(sel); }

  // ====== Ranking ======
  function getLeaderboard(){
    if (hasSB){
      return sb.from('scores').select('name,score,date').order('score',{ascending:false}).then(function(res){
        if (res.error){ console.error('SELECT error:', res.error); alert('Ranking ONLINE: '+res.error.message); return []; }
        return res.data||[];
      });
    }
    try{ return Promise.resolve(JSON.parse(localStorage.getItem(LS.leaderboard)||'[]')); }catch(e){ return Promise.resolve([]); }
  }
  function saveScore(entry){
    if (hasSB){
      return sb.from('scores').insert(entry).then(function(res){
        if(res.error){ console.error('INSERT error:', res.error); alert('Guardar ONLINE: '+res.error.message); }
      });
    }
    var list=[]; try{ list=JSON.parse(localStorage.getItem(LS.leaderboard)||'[]'); }catch(e){}
    list.push(entry);
    localStorage.setItem(LS.leaderboard, JSON.stringify(list));
    return Promise.resolve();
  }
  function isNameTaken(name){
    if (hasSB){
      return sb.from('scores').select('name').ilike('name', name).limit(1).then(function(res){
        if(res.error){ console.warn('NAME check error:', res.error); return false; }
        return (res.data||[]).length>0;
      });
    }
    var list=[]; try{ list=JSON.parse(localStorage.getItem(LS.leaderboard)||'[]'); }catch(e){}
    var lower=(name||'').toLowerCase();
    for(var i=0;i<list.length;i++){ if((list[i].name||'').toLowerCase()===lower) return Promise.resolve(true); }
    return Promise.resolve(false);
  }

  // ====== Estado ======
  var state={
    screen:'gate',
    pin:'',
    name:'',
    questions:QUESTIONS.slice(0,40), // TODAS, sin aleatoriedad
    qIndex:0,
    answers:new Array(40).fill(-1),
    left:SECONDS_PER_QUESTION,
    timer:null
  };
  var locked=false;

  // ====== Render ======
  function render(){
    var app=$('#app');
    app.classList.remove('show');
    setTimeout(function(){ app.innerHTML=screens[state.screen](); app.classList.add('show'); bind(); },120);
  }

  var screens={
    gate:function(){
      return '<div class="center">'
           +   '<div class="row" style="justify-content:center;gap:10px;margin-bottom:8px"><div class="pill"><span>⚽️</span> Fútbol Quiz — Online</div></div>'
           +   '<h1>Introduce el PIN</h1>'
           +   '<input id="pin" type="tel" inputmode="numeric" placeholder="PIN">'
           +   '<div style="height:8px"></div>'
           +   '<button id="goName" class="btn" disabled>Continuar</button>'
           + '</div>';
    },
name:function(){
  return '<h1>Listo para jugar?</h1>'
       + '<input id="player" maxlength="20" placeholder="Tu nombre">'
       + '<div style="height:8px"></div>'
       + '<button id="start" class="btn">Empezar</button>'
       + '<p style="margin-top:10px;font-size:14px;text-align:center">'
       +   '<a href="#" id="goRanking" style="color:var(--accent);text-decoration:underline">Ver ranking</a>'
       + '</p>'
       + '<p class="muted">El juego consiste en '+QUESTIONS_COUNT+' preguntas. Cada acierto es 1 punto; si encadenas '+STREAK_BONUS_AT+' seguidas, ganas +1 extra.</p>';
},
    quiz:function(){
      var q=state.questions[state.qIndex];
      var progress=100*(SECONDS_PER_QUESTION-state.left)/SECONDS_PER_QUESTION;
      var html='';
      html+='<div class="row small"><div>Pregunta '+(state.qIndex+1)+'/'+QUESTIONS_COUNT+'</div><div id="counter">'+state.left+'s</div></div>';
      html+='<div class="progress"><div class="bar" id="bar" style="width:'+progress+'%"></div></div>';
      html+='<div class="question">'+q.t+'</div>';
      html+='<div class="opts" id="opts">';
      for(var i=0;i<q.o.length;i++){ html+='<button class="opt" data-i="'+i+'">'+q.o[i]+'</button>'; }
      html+='</div><div id="nextSlot" style="margin-top:12px"></div>';
      return html;
    },
    summary:function(){
      var calc=calcScore();
      var html='<h2>Resultados</h2>'
              +'<div class="row small"><div>Puntos aciertos: '+calc.base+'</div><div>Bonus racha: +'+calc.bonus+'</div></div>'
              +'<div class="row small"><div>Total:</div><div style="font-weight:800">'+calc.total+'</div></div>'
              +'<div class="list" style="margin-top:8px">';
      for(var idx=0; idx<state.questions.length; idx++){
        var q=state.questions[idx];
        html+='<div class="rowitem"><div class="small" style="flex:1;margin-right:8px">'+(idx+1)+'. '+q.t+'</div><div class="small" style="flex:1">';
        for(var i=0;i<q.o.length;i++){
          var isC=(i===q.c), isS=(state.answers[idx]===i);
          var bg=isC?'var(--ok)':(isS?'var(--wrong)':'#fff');
          var style='background:'+bg+';border-radius:10px;padding:4px 8px;margin-left:6px';
          html+='<span style="'+style+'">'+q.o[i]+'</span>';
        }
        html+='</div></div>';
      }
      html+='</div><div class="row" style="margin-top:10px"><button id="save" class="btn" style="flex:1">Guardar y ver ranking</button><button id="replay" class="input" style="flex:1;text-align:center;font-weight:600">Rejugar</button></div>';
      return html;
    },
    leaderboard:function(){
      return '<h2>Ranking histórico</h2>'
           + '<div id="lb" class="list" style="margin-top:8px"></div>'
           + '<div style="height:8px"></div>'
           + '<button id="home" class="input" style="width:100%;text-align:center;font-weight:600">Volver al inicio</button>';
    }
  };

  // ====== Bind ======
  function bind(){
    if(state.screen==='gate'){
      var pin=$('#pin'), go=$('#goName');
      pin.value=state.pin;
      pin.oninput=function(e){ state.pin=e.target.value; go.disabled=(state.pin!==PIN_CODE); };
      go.onclick=function(){ if(state.pin===PIN_CODE){ state.screen='name'; render(); } };
    }

    if(state.screen==='name'){
      $('#start').onclick=function(){
        var n=$('#player').value.trim();
        if(!n || n.replace(/\s+/g,'').length<2){ alert('El nombre debe tener al menos 2 caracteres.'); return; }
        isNameTaken(n).then(function(taken){
          if(taken){ alert('Ese nombre ya existe. Elige otro.'); return; }
          state.name=n; startQuiz();
        });
      };
      var gr=$('#goRanking');
      if(gr){ gr.onclick=function(){ state.screen='leaderboard'; render(); }; }
    }

    if(state.screen==='quiz'){
      if(state.timer) clearInterval(state.timer);
      state.left=SECONDS_PER_QUESTION;
      var bar=$('#bar'), counter=$('#counter');
      state.timer=setInterval(function(){
        state.left-=1;
        if(state.left<=0){ clearInterval(state.timer); showFeedbackAndNext(null); }
        else {
          if(counter) counter.innerText=state.left+'s';
          if(bar) bar.style.width=(100*(SECONDS_PER_QUESTION-state.left)/SECONDS_PER_QUESTION)+'%';
        }
      },1000);

      locked=false;
      var opts=document.querySelectorAll('.opt');
      for(var k=0;k<opts.length;k++){
        opts[k].onclick=function(){
          if(locked) return;
          locked=true;
          clearInterval(state.timer);
          var i=parseInt(this.getAttribute('data-i'),10);
          state.answers[state.qIndex]=i;
          showFeedbackAndNext(i);
        };
      }
    }

    if(state.screen==='summary'){
      $('#save').onclick=function(){
        var total=calcScore().total;
        saveScore({name:state.name,score:total,date:new Date().toISOString()}).then(function(){
          state.screen='leaderboard'; render();
        });
      };
      $('#replay').onclick=function(){ resetGame(true); };
    }

    if(state.screen==='leaderboard'){
      getLeaderboard().then(function(list){
        var el=$('#lb'), html='';
        list.sort(function(a,b){return (b.score||0)-(a.score||0);});
        for(var i=0;i<Math.min(list.length,100);i++){
          html+='<div class="rowitem"><div class="row" style="gap:10px"><strong>'+(i+1)+'</strong><span>'+list[i].name+'</span></div><strong>'+list[i].score+'</strong></div>';
        }
        el.innerHTML=html || '<div class="rowitem"><span class="small">Aún no hay puntuaciones.</span><span>—</span></div>';
      });
      $('#home').onclick=function(){ resetGame(false); };
    }
  }

  // ====== Feedback + Siguiente ======
  function showFeedbackAndNext(selectedIndex){
    var q=state.questions[state.qIndex];
    var opts=document.querySelectorAll('.opt');
    for(var j=0;j<opts.length;j++){
      var idx=parseInt(opts[j].getAttribute('data-i'),10);
      if(idx===q.c){ opts[j].style.background='var(--ok)'; opts[j].style.color='#fff'; }
      else if(selectedIndex!==null && idx===selectedIndex){ opts[j].style.background='var(--wrong)'; }
      else { opts[j].style.opacity=0.6; }
      opts[j].disabled=true;
    }
    var slot=$('#nextSlot');
    if(slot && !slot.firstChild){
      var btnNext=document.createElement('button');
      btnNext.innerText='Siguiente';
      btnNext.className='btn';
      btnNext.style.width='100%';
      btnNext.onclick=function(){ nextQ(); };
      slot.appendChild(btnNext);
    }
  }

  // ====== Flujo ======
  function nextQ(){
    if(state.qIndex+1<QUESTIONS_COUNT){ state.qIndex++; render(); }
    else { if(state.timer) clearInterval(state.timer); state.screen='summary'; render(); }
  }
  function calcScore(){
    var base=0,streak=0,maxStreak=0;
    for(var i=0;i<QUESTIONS_COUNT;i++){
      var q=state.questions[i],a=state.answers[i];
      if(a===q.c){ base+=1; streak+=1; } else { streak=0; }
      if(streak>maxStreak) maxStreak=streak;
    }
    var bonus=Math.floor(maxStreak/STREAK_BONUS_AT);
    return {base:base,bonus:bonus,total:base+bonus,maxStreak:maxStreak};
  }
  function startQuiz(){
    if(state.timer) clearInterval(state.timer);
    state.screen='quiz'; state.qIndex=0; state.answers=new Array(QUESTIONS_COUNT).fill(-1);
    state.left=SECONDS_PER_QUESTION; render();
  }
  function resetGame(replay){
    state.questions=QUESTIONS.slice(0,QUESTIONS_COUNT); // sin aleatoriedad
    state.qIndex=0; state.answers=new Array(QUESTIONS_COUNT).fill(-1);
    state.left=SECONDS_PER_QUESTION; if(state.timer) clearInterval(state.timer);
    state.screen = replay ? 'quiz' : 'gate'; state.pin=''; render();
  }

  // init
  render();
})();
</script>
</body>
</html>
